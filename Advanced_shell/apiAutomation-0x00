#!/bin/bash

# Pokémon API automation script
# Fetches Pikachu data and saves to data.json
# Logs errors to errors.txt if request fails

# Set the API endpoint for Pikachu
API_URL="https://pokeapi.co/api/v2/pokemon/pikachu"

# Output files
DATA_FILE="data.json"
ERROR_FILE="errors.txt"

echo "Fetching Pikachu data from Pokémon API..."

# Make the API request and capture both output and exit status
if response=$(curl -s -w "%{http_code}" "$API_URL" 2>/dev/null); then
    # Extract HTTP status code (last 3 characters)
    http_code="${response: -3}"
    
    # Extract response body (everything except last 3 characters)
    response_body="${response%???}"
    
    # Check if the request was successful (HTTP 200)
    if [ "$http_code" -eq 200 ]; then
        # Save successful response to data.json
        echo "$response_body" > "$DATA_FILE"
        echo "✅ Successfully retrieved Pikachu data and saved to $DATA_FILE"
        echo "📊 Data file size: $(wc -c < "$DATA_FILE") bytes"
    else
        # Log error for non-200 status codes
        error_msg="HTTP Error: $http_code - Failed to retrieve Pikachu data"
        echo "$error_msg" >> "$ERROR_FILE"
        echo "❌ $error_msg - Check $ERROR_FILE for details"
        exit 1
    fi
else
    # Log curl command failure
    error_msg="Curl Error: Failed to connect to Pokémon API"
    echo "$error_msg" >> "$ERROR_FILE"
    echo "❌ $error_msg - Check $ERROR_FILE for details"
    exit 1
fi

echo "🎉 Script completed successfully!"
